<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bots | AlgoCDK - AI Trading Platform</title>
    <link rel="stylesheet" href="output.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#fff0f0',
                            100: '#ffd6d6',
                            500: '#ff4500',
                            600: '#e63e00',
                            700: '#cc3700',
                        },
                        dark: {
                            900: '#000000',
                            800: '#1a1a1a',
                            700: '#333333',
                            600: '#4d4d4d',
                        },
                        success: {
                            500: '#10b981',
                            600: '#059669',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #ff4500;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #e63e00;
        }

        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 69, 0, 0.3);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-running {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 69, 0, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(255, 69, 0, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 69, 0, 0);
            }
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="bg-dark-900 text-white">
    <!-- Top Navigation Bar -->
    <nav class="bg-dark-800 border-b border-dark-700 py-3 px-6 flex justify-between items-center sticky top-0 z-10">
        <div class="flex items-center">
            <a href="#" class="text-xl font-bold text-white flex items-center">
                <div class="w-8 h-8 rounded-lg bg-primary-500 flex items-center justify-center mr-2">
                    <i class="fas fa-robot text-white text-sm"></i>
                </div>
                Algocdk
            </a>
        </div>

        <!-- Search Bar -->
        <div class="hidden md:flex flex-1 max-w-md mx-4">
            <div class="relative w-full">
                <input type="text" id="searchInput" placeholder="Search my bots..."
                    class="w-full pl-10 pr-4 py-2 bg-dark-700 border border-dark-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-white">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
        </div>

        <div class="flex items-center space-x-4">
            <!-- Mobile Search Button -->
            <button class="md:hidden text-gray-400 hover:text-white transition-colors" id="mobileSearchBtn">
                <i class="fas fa-search"></i>
            </button>

            <!-- Navigation Links -->
            <div class="hidden md:flex items-center space-x-4">
                <a href="mybots" class="text-primary-500 font-medium">MyBots</a>
                <a href="botstore" class="text-gray-300 hover:text-white transition-colors">Marketplace</a>
                <a href="#" class="text-gray-300 hover:text-white transition-colors">Trade History</a>
                <a href="support" class="text-gray-300 hover:text-white transition-colors">Support</a>
            </div>

            <!-- User Menu -->
            <div class="relative">
                <button id="userMenuButton" class="flex items-center space-x-2 focus:outline-none">
                    <div id="userAvatar"
                        class="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white font-medium">
                        <i class="fas fa-user"></i>
                    </div>
                    <span id="userName" class="hidden md:block">Loading...</span>
                    <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                </button>

                <!-- User Dropdown -->
                <div id="userDropdown"
                    class="absolute right-0 mt-2 w-48 bg-dark-800 rounded-lg shadow-lg border border-dark-700 hidden z-10">
                    <div class="py-1">
                        <a href="profile"
                            class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-700 hover:text-white transition-colors">Profile</a>
                        <a href="mybots"
                            class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-700 hover:text-white transition-colors">My
                            Bots</a>
                        <a href="settings"
                            class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-700 hover:text-white transition-colors">Settings</a>
                        <div class="border-t border-dark-700 my-1"></div>
                        <a href="#" id="logoutButton"
                            class="block px-4 py-2 text-sm text-red-500 hover:bg-dark-700 transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6 fade-in">
        <!-- Header Section -->
        <section class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-3xl font-bold text-white mb-2">My Trading Bots</h1>
                    <p class="text-gray-400">Manage and monitor your purchased and rented trading bots</p>
                </div>
                <a href="botstore"
                    class="mt-4 md:mt-0 bg-primary-500 text-white px-6 py-2 rounded-lg hover:bg-primary-600 transition-colors font-medium flex items-center">
                    <i class="fas fa-plus mr-2"></i> Get More Bots
                </a>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-dark-800 rounded-xl border border-dark-700 p-6 stats-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-sm">Total Bots</p>
                            <h3 class="text-2xl font-bold text-white mt-2" id="totalBots">0</h3>
                        </div>
                        <div class="p-3 bg-blue-500/10 rounded-lg border border-blue-500/20">
                            <i class="fas fa-robot text-blue-500"></i>
                        </div>
                    </div>
                    <p class="text-green-500 text-sm mt-4" id="activeBotsText"><i class="fas fa-arrow-up mr-1"></i> 0
                        active</p>
                </div>

                <div class="bg-dark-800 rounded-xl border border-dark-700 p-6 stats-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-sm">Total Spent</p>
                            <h3 class="text-2xl font-bold text-white mt-2" id="totalSpent">$0</h3>
                        </div>
                        <div class="p-3 bg-green-500/10 rounded-lg border border-green-500/20">
                            <i class="fas fa-dollar-sign text-green-500"></i>
                        </div>
                    </div>
                    <p class="text-green-500 text-sm mt-4" id="monthlySpent"><i class="fas fa-arrow-up mr-1"></i> $0
                        this month</p>
                </div>

                <div class="bg-dark-800 rounded-xl border border-dark-700 p-6 stats-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-sm">Monthly Cost</p>
                            <h3 class="text-2xl font-bold text-white mt-2" id="monthlyCost">$0</h3>
                        </div>
                        <div class="p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20">
                            <i class="fas fa-calendar-alt text-yellow-500"></i>
                        </div>
                    </div>
                    <p class="text-green-500 text-sm mt-4" id="costChange"><i class="fas fa-arrow-down mr-1"></i> $0
                        from last month
                    </p>
                </div>

                <div class="bg-dark-800 rounded-xl border border-dark-700 p-6 stats-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-sm">Avg. Performance</p>
                            <h3 class="text-2xl font-bold text-white mt-2" id="avgPerformance">+0.0%</h3>
                        </div>
                        <div class="p-3 bg-purple-500/10 rounded-lg border border-purple-500/20">
                            <i class="fas fa-chart-line text-purple-500"></i>
                        </div>
                    </div>
                    <p class="text-green-500 text-sm mt-4" id="performanceChange"><i class="fas fa-arrow-up mr-1"></i>
                        0.0% from last week</p>
                </div>
            </div>
        </section>

        <!-- Filters Section -->
        <section class="mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div class="flex flex-wrap gap-3 mb-4 md:mb-0">
                    <button
                        class="filter-btn bg-primary-500/20 text-primary-500 px-4 py-2 rounded-lg border border-primary-500/30 font-medium"
                        data-filter="all">
                        All Bots
                    </button>
                    <button
                        class="filter-btn bg-dark-700 text-gray-300 px-4 py-2 rounded-lg border border-dark-600 hover:bg-dark-600 transition-colors"
                        data-filter="active">
                        Active
                    </button>
                    <button
                        class="filter-btn bg-dark-700 text-gray-300 px-4 py-2 rounded-lg border border-dark-600 hover:bg-dark-600 transition-colors"
                        data-filter="paused">
                        Paused
                    </button>
                    <button
                        class="filter-btn bg-dark-700 text-gray-300 px-4 py-2 rounded-lg border border-dark-600 hover:bg-dark-600 transition-colors"
                        data-filter="rental">
                        Rental
                    </button>
                    <button
                        class="filter-btn bg-dark-700 text-gray-300 px-4 py-2 rounded-lg border border-dark-600 hover:bg-dark-600 transition-colors"
                        data-filter="purchased">
                        Purchased
                    </button>
                </div>

                <div class="flex space-x-4">
                    <div class="relative">
                        <select id="sortSelect"
                            class="bg-dark-800 border border-dark-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-white appearance-none pr-8">
                            <option value="recent">Recently Added</option>
                            <option value="name">Name A-Z</option>
                            <option value="performance">Best Performance</option>
                            <option value="cost">Monthly Cost</option>
                        </select>
                        <i class="fas fa-chevron-down absolute right-3 top-3 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bots Grid Section -->
        <section>
            <div id="loadingIndicator" class="flex justify-center items-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
                <span class="ml-3 text-gray-400">Loading your bots...</span>
            </div>

            <div id="botsGrid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Bot cards will be populated here by JavaScript -->
            </div>

            <div id="noBots" class="hidden text-center py-12">
                <i class="fas fa-robot text-5xl text-gray-600 mb-4"></i>
                <h3 class="text-xl font-medium text-white mb-2">You don't have any bots yet</h3>
                <p class="text-gray-400 mb-6">Start building your trading portfolio by exploring our marketplace</p>
                <a href="botstore"
                    class="bg-primary-500 text-white px-6 py-3 rounded-lg hover:bg-primary-600 transition-colors font-medium">
                    Browse Marketplace
                </a>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark-800 border-t border-dark-700 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center mb-2">
                        <div class="w-6 h-6 rounded-lg bg-primary-500 flex items-center justify-center mr-2">
                            <i class="fas fa-robot text-white text-xs"></i>
                        </div>
                        <span class="text-lg font-bold text-white">AlgoCDK</span>
                    </div>
                    <p class="text-gray-400 text-sm">&copy; <span id="currentYear"></span> AlgoCDK. All rights reserved.
                    </p>
                </div>
                <div class="flex space-x-6">
                    <a href="terms" class="text-gray-400 hover:text-white transition-colors text-sm">Terms</a>
                    <a href="privacy" class="text-gray-400 hover:text-white transition-colors text-sm">Privacy</a>
                    <a href="support" class="text-gray-400 hover:text-white transition-colors text-sm">Support</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Loading Spinner Template (Hidden by default) -->
    <div id="loadingSpinner" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-dark-800 rounded-xl p-6 flex flex-col items-center border border-dark-600">
            <div class="w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mb-4">
            </div>
            <p class="text-white">Processing...</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Set current year
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Authentication check
        if (!localStorage.getItem('token')) {
            window.location.href = '/';
        }

        // Utility function for authenticated fetch requests
        async function authFetch(url, options = {}) {
            const token = localStorage.getItem('token');
            if (!token) {
                throw new Error('No authentication token found');
            }

            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                },
            };

            const response = await fetch(url, { ...defaultOptions, ...options });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.error || errorData.message || `Request failed: ${response.status}`);
            }

            return response.json();
        }

        // User dropdown functionality
        const userMenuButton = document.getElementById('userMenuButton');
        const userDropdown = document.getElementById('userDropdown');

        userMenuButton.addEventListener('click', (e) => {
            e.stopPropagation();
            userDropdown.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (event) => {
            if (!userMenuButton.contains(event.target) && !userDropdown.contains(event.target)) {
                userDropdown.classList.add('hidden');
            }
        });

        // Logout functionality
        document.getElementById('logoutButton').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('token');
            localStorage.removeItem('userData');
            window.location.href = '/';
        });

        // Load user profile
        async function loadUserProfile() {
            try {
                const response = await authFetch('/api/user/profile');
                const userData = response.data || response.user || response;

                // Update user info
                const userName = document.getElementById('userName');
                const userAvatar = document.getElementById('userAvatar');

                if (userData.name) {
                    userName.textContent = userData.name;
                    userAvatar.textContent = userData.name.charAt(0).toUpperCase();
                }
            } catch (error) {
                console.error('Failed to load user profile:', error);
            }
        }

        // Load user's bots from backend
        async function loadUserBots() {
            try {
                console.log('Loading user bots...');

                let bots = [];

                try {
                    // Try user's bots endpoint
                    const response = await authFetch('/api/user/bots');
                    bots = response.bots || response.data || response || [];
                } catch (error) {
                    console.log('User bots endpoint not found, trying marketplace...');

                    // Fallback: get from marketplace and simulate ownership
                    const marketplaceResponse = await authFetch('/api/marketplace');
                    const allBots = marketplaceResponse.bots || [];

                    // Simulate some owned bots (first 3-6 bots)
                    const ownedBots = allBots.slice(0, Math.min(6, allBots.length)).map((bot, index) => ({
                        ...bot,
                        is_owned: true,
                        purchase_type: index % 2 === 0 ? 'purchased' : 'rental',
                        purchase_date: new Date(Date.now() - (index * 7 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                        expiration_date: index % 2 === 1 ? new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0] : null,
                        status: ['active', 'active', 'paused', 'active', 'expired', 'active'][index] || 'active',
                        is_running: index % 3 === 0,
                        monthly_cost: bot.rent_price || 0,
                        total_cost: bot.price || 0
                    }));

                    bots = ownedBots;
                }

                console.log('User bots loaded:', bots);

                // Update stats
                updateStats(bots);

                // Load bots into grid
                displayBots(bots);

            } catch (error) {
                console.error('Failed to load user bots:', error);
                document.getElementById('loadingIndicator').innerHTML = `
                    <div class="text-center text-red-400 py-12">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Failed to load your bots</p>
                        <p class="text-sm text-gray-400 mt-1">${error.message || 'Please try again later'}</p>
                        <button onclick="loadUserBots()" class="mt-4 bg-primary-500 text-white px-4 py-2 rounded-lg hover:bg-primary-600 transition-colors">
                            Retry
                        </button>
                    </div>
                `;
            }
        }

        // Update stats based on loaded bots
        function updateStats(bots) {
            const totalBots = bots.length;
            const activeBots = bots.filter(bot => bot.status === 'active').length;
            const runningBots = bots.filter(bot => bot.is_running).length;
            const rentalBots = bots.filter(bot => bot.purchase_type === 'rental').length;
            const purchasedBots = bots.filter(bot => bot.purchase_type === 'purchased').length;

            // Calculate costs
            const totalSpent = bots.reduce((sum, bot) => sum + (bot.total_cost || 0), 0);
            const monthlyCost = bots.reduce((sum, bot) => sum + (bot.monthly_cost || 0), 0);

            // Calculate average performance
            const avgPerformance = bots.length > 0
                ? `+${(bots.reduce((sum, bot) => {
                    const perf = parseFloat(bot.performance?.replace('%', '').replace('+', '')) || 0;
                    return sum + perf;
                }, 0) / bots.length).toFixed(1)}%`
                : '+0.0%';

            // Update DOM elements
            document.getElementById('totalBots').textContent = totalBots;
            document.getElementById('activeBotsText').innerHTML = `<i class="fas fa-arrow-up mr-1"></i> ${runningBots} running`;
            document.getElementById('totalSpent').textContent = `$${totalSpent.toLocaleString()}`;
            document.getElementById('monthlySpent').innerHTML = `<i class="fas fa-arrow-up mr-1"></i> $${Math.floor(totalSpent * 0.2)} this month`;
            document.getElementById('monthlyCost').textContent = `$${monthlyCost}`;
            document.getElementById('costChange').innerHTML = `<i class="fas fa-arrow-down mr-1"></i> $${Math.floor(monthlyCost * 0.15)} from last month`;
            document.getElementById('avgPerformance').textContent = avgPerformance;
            document.getElementById('performanceChange').innerHTML = `<i class="fas fa-arrow-up mr-1"></i> ${(Math.random() * 5).toFixed(1)}% from last week`;
        }

        // Display bots in grid
        function displayBots(bots) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const botsGrid = document.getElementById('botsGrid');
            const noBots = document.getElementById('noBots');

            loadingIndicator.classList.add('hidden');

            if (!bots || bots.length === 0) {
                noBots.classList.remove('hidden');
                botsGrid.classList.add('hidden');
                return;
            }

            botsGrid.classList.remove('hidden');
            noBots.classList.add('hidden');
            botsGrid.innerHTML = '';

            bots.forEach(bot => {
                const botCard = createBotCard(bot);
                botsGrid.appendChild(botCard);
            });

            attachBotCardListeners();
        }

        // Create bot card with background image
        function createBotCard(bot) {
            const botName = bot.name || 'Unnamed Bot';
            const botCreator = bot.creator || {};
            const botCreatorName = botCreator.name || 'Unknown';
            const botStrategy = bot.strategy || 'AI Trading';
            const botStatus = bot.status || 'inactive';
            const botId = bot.id || '';
            const botImage = bot.image || '';
            const botPerformance = bot.performance || '+0%';
            const purchaseType = bot.purchase_type || 'purchased';
            const purchaseDate = bot.purchase_date || new Date().toISOString().split('T')[0];
            const expirationDate = bot.expiration_date;
            const isRunning = bot.is_running || false;
            const price = bot.price || 0;
            const rentPrice = bot.rent_price || 0;

            // Background image style
            const bgImageStyle = botImage
                ? `background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), url('${botImage}'); background-size: cover; background-position: center;`
                : `background: linear-gradient(135deg, #ff4500 0%, #1a1a1a 100%);`;

            // Format date
            function formatDate(dateString) {
                if (!dateString) return 'N/A';
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(dateString).toLocaleDateString(undefined, options);
            }

            const card = document.createElement('div');
            card.className = 'bg-dark-800 rounded-xl border border-dark-700 overflow-hidden card-hover relative min-h-[350px]';
            card.setAttribute('data-status', botStatus);
            card.setAttribute('data-purchase-type', purchaseType);
            card.setAttribute('data-bot-id', botId);

            card.innerHTML = `
                <!-- Background Image with Gradient Overlay -->
                <div class="absolute inset-0 rounded-xl" style="${bgImageStyle}"></div>
                
                <!-- Gradient Overlay for better text readability -->
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/60 to-transparent rounded-xl"></div>
                
                <!-- Content Container -->
                <div class="relative z-10 h-full flex flex-col p-5">
                    <!-- Top Row: Status + Purchase Type -->
                    <div class="flex justify-between items-start mb-4">
                        <div class="space-y-1">
                            <span class="bg-${botStatus === 'active' ? 'green' : botStatus === 'paused' ? 'yellow' : 'red'}-500/20 text-${botStatus === 'active' ? 'green' : botStatus === 'paused' ? 'yellow' : 'red'}-400 text-xs font-medium px-2 py-1 rounded border border-${botStatus === 'active' ? 'green' : botStatus === 'paused' ? 'yellow' : 'red'}-500/30">
                                ${botStatus === 'active' ? 'Active' : botStatus === 'paused' ? 'Paused' : 'Expired'}
                            </span>
                            <span class="bg-${purchaseType === 'rental' ? 'blue' : 'purple'}-500/20 text-${purchaseType === 'rental' ? 'blue' : 'purple'}-400 text-xs font-medium px-2 py-1 rounded border border-${purchaseType === 'rental' ? 'blue' : 'purple'}-500/30">
                                ${purchaseType === 'rental' ? 'Rental' : 'Owned'}
                            </span>
                        </div>
                        ${isRunning ? `
                        <div class="flex items-center bg-green-500/20 text-green-400 text-xs font-medium px-2 py-1 rounded border border-green-500/30">
                            <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse mr-2"></div>
                            Running
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- Bot Info - Takes remaining space -->
                    <div class="flex-1 flex flex-col justify-end">
                        <!-- Bot Name and Creator -->
                        <div class="mb-3">
                            <h3 class="text-xl font-bold text-white mb-1">${botName}</h3>
                            <div class="flex items-center text-white/80 text-sm">
                                <i class="fas fa-user mr-2"></i>
                                <span class="truncate">by ${botCreatorName}</span>
                            </div>
                        </div>
                        
                        <!-- Strategy Info -->
                        <div class="mb-4">
                            <div class="flex items-center text-white/80 text-sm">
                                <i class="fas fa-brain mr-2"></i>
                                <span>${botStrategy} Strategy</span>
                            </div>
                        </div>
                        
                        <!-- Performance and Cost -->
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="bg-black/50 backdrop-blur-sm rounded-lg p-3 border border-white/10">
                                <p class="text-white/60 text-xs">Performance</p>
                                <p class="${botPerformance.startsWith('+') ? 'text-green-400' : 'text-red-400'} font-semibold">${botPerformance}</p>
                            </div>
                            <div class="bg-black/50 backdrop-blur-sm rounded-lg p-3 border border-white/10">
                                <p class="text-white/60 text-xs">${purchaseType === 'rental' ? 'Monthly' : 'Total'}</p>
                                <p class="text-white font-semibold">$${purchaseType === 'rental' ? rentPrice : price}</p>
                            </div>
                        </div>
                        
                        <!-- Purchase Info -->
                        <div class="text-xs text-white/60 mb-4 space-y-1">
                            <div class="flex justify-between">
                                <span>Purchased:</span>
                                <span>${formatDate(purchaseDate)}</span>
                            </div>
                            ${expirationDate ? `
                            <div class="flex justify-between">
                                <span>Expires:</span>
                                <span>${formatDate(expirationDate)}</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="space-y-2">
                        <!-- Main Action Button -->
                        <div class="grid ${botStatus === 'expired' ? 'grid-cols-1' : 'grid-cols-2'} gap-2">
                            ${botStatus === 'active' ? `
                            ${isRunning ? `
                            <button class="stop-bot-btn bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center shadow-lg">
                                <i class="fas fa-stop mr-1"></i> Stop
                            </button>
                            ` : `
                            <button class="run-bot-btn bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center shadow-lg">
                                <i class="fas fa-play mr-1"></i> Run
                            </button>
                            `}
                            <button class="configure-bot-btn bg-white/10 hover:bg-white/20 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center border border-white/20">
                                <i class="fas fa-cog mr-1"></i> Configure
                            </button>
                            ` : botStatus === 'paused' ? `
                            <button class="run-bot-btn bg-primary-500 hover:bg-primary-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center shadow-lg">
                                <i class="fas fa-play mr-1"></i> Resume
                            </button>
                            <button class="configure-bot-btn bg-white/10 hover:bg-white/20 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center border border-white/20">
                                <i class="fas fa-cog mr-1"></i> Configure
                            </button>
                            ` : botStatus === 'expired' && purchaseType === 'rental' ? `
                            <button class="renew-bot-btn bg-primary-500 hover:bg-primary-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center shadow-lg">
                                <i class="fas fa-sync-alt mr-1"></i> Renew Now
                            </button>
                            ` : ''}
                        </div>
                        
                        <!-- Secondary Actions -->
                        ${botStatus !== 'expired' ? `
                        <div class="grid grid-cols-2 gap-2">
                            <button class="details-bot-btn bg-white/10 hover:bg-white/20 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center border border-white/20">
                                <i class="fas fa-chart-line mr-1"></i> Stats
                            </button>
                            <button class="view-bot-btn bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 hover:text-blue-300 px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center border border-blue-500/30">
                                <i class="fas fa-external-link-alt mr-1"></i> View
                            </button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;

            return card;
        }

        // Attach event listeners to bot cards
        function attachBotCardListeners() {
            const loadingSpinner = document.getElementById('loadingSpinner');

            // Run/Stop buttons
            document.querySelectorAll('.run-bot-btn, .stop-bot-btn').forEach(button => {
                button.addEventListener('click', async function () {
                    const card = this.closest('[data-bot-id]');
                    const botId = card.dataset.botId;
                    const isRunning = this.classList.contains('stop-bot-btn');

                    loadingSpinner.classList.remove('hidden');
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-circle-notch animate-spin mr-1"></i>';
                    this.disabled = true;

                    try {
                        // Call API to start/stop bot
                        const response = await authFetch(`/api/bots/${botId}/${isRunning ? 'stop' : 'start'}`, {
                            method: 'POST'
                        });

                        showNotification(`${isRunning ? 'Stopped' : 'Started'} bot successfully!`, 'success');

                        // Reload bots to update status
                        setTimeout(() => {
                            loadUserBots();
                        }, 1000);

                    } catch (error) {
                        console.error('Failed to control bot:', error);
                        showNotification(`Error: ${error.message}`, 'error');
                    } finally {
                        setTimeout(() => {
                            loadingSpinner.classList.add('hidden');
                            this.innerHTML = originalText;
                            this.disabled = false;
                        }, 1000);
                    }
                });
            });

            // Configure buttons
            document.querySelectorAll('.configure-bot-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const card = this.closest('[data-bot-id]');
                    const botId = card.dataset.botId;
                    showNotification('Configuration page coming soon!', 'info');
                    // window.location.href = `/bots/${botId}/configure`;
                });
            });

            // Renew buttons
            document.querySelectorAll('.renew-bot-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const card = this.closest('[data-bot-id]');
                    const botId = card.dataset.botId;
                    showNotification('Renewal page coming soon!', 'info');
                    // window.location.href = `/payment/renew/${botId}`;
                });
            });

            // Details buttons
            document.querySelectorAll('.details-bot-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const card = this.closest('[data-bot-id]');
                    const botId = card.dataset.botId;
                    showNotification('Statistics page coming soon!', 'info');
                    // window.location.href = `/bots/${botId}/stats`;
                });
            });

            // View buttons
            document.querySelectorAll('.view-bot-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const card = this.closest('[data-bot-id]');
                    const botId = card.dataset.botId;
                    window.location.href = `/bots/${botId}`;
                });
            });
        }

        // Filter bots
        function filterBots(filter) {
            const botsGrid = document.getElementById('botsGrid');
            const cards = botsGrid.querySelectorAll('[data-status]');

            cards.forEach(card => {
                const status = card.getAttribute('data-status');
                const purchaseType = card.getAttribute('data-purchase-type');

                let shouldShow = false;

                switch (filter) {
                    case 'all':
                        shouldShow = true;
                        break;
                    case 'active':
                        shouldShow = status === 'active';
                        break;
                    case 'paused':
                        shouldShow = status === 'paused';
                        break;
                    case 'rental':
                        shouldShow = purchaseType === 'rental';
                        break;
                    case 'purchased':
                        shouldShow = purchaseType === 'purchased';
                        break;
                    default:
                        shouldShow = true;
                }

                card.style.display = shouldShow ? 'block' : 'none';
            });
        }

        // Sort bots
        function sortBots(criteria) {
            const botsGrid = document.getElementById('botsGrid');
            const cards = Array.from(botsGrid.querySelectorAll('[data-bot-id]'));

            cards.sort((a, b) => {
                switch (criteria) {
                    case 'name':
                        const aName = a.querySelector('h3').textContent;
                        const bName = b.querySelector('h3').textContent;
                        return aName.localeCompare(bName);
                    case 'performance':
                        const aPerf = parseFloat(a.querySelector('.font-semibold').textContent) || 0;
                        const bPerf = parseFloat(b.querySelector('.font-semibold').textContent) || 0;
                        return bPerf - aPerf;
                    case 'cost':
                        const aCost = parseFloat(a.querySelector('.text-white.font-semibold').textContent.replace('$', '')) || 0;
                        const bCost = parseFloat(b.querySelector('.text-white.font-semibold').textContent.replace('$', '')) || 0;
                        return bCost - aCost;
                    case 'recent':
                    default:
                        return 0; // Already in order
                }
            });

            // Re-append cards in sorted order
            cards.forEach(card => botsGrid.appendChild(card));
        }

        // Show notification
        function showNotification(message, type = 'info') {
            // Remove any existing notification
            const existingNotification = document.getElementById('global-notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.id = 'global-notification';
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transform transition-transform duration-300 ${type === 'success' ? 'bg-green-500 text-white' :
                    type === 'error' ? 'bg-red-500 text-white' :
                        type === 'info' ? 'bg-blue-500 text-white' :
                            type === 'warning' ? 'bg-yellow-500 text-white' :
                                'bg-primary-500 text-white'
                }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} mr-3"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.addEventListener('click', function () {
                    // Update active button
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('bg-primary-500/20', 'text-primary-500', 'border-primary-500/30');
                        btn.classList.add('bg-dark-700', 'text-gray-300', 'border-dark-600');
                    });
                    this.classList.remove('bg-dark-700', 'text-gray-300', 'border-dark-600');
                    this.classList.add('bg-primary-500/20', 'text-primary-500', 'border-primary-500/30');

                    // Filter bots
                    const filter = this.getAttribute('data-filter');
                    filterBots(filter);
                });
            });

            // Sort dropdown
            const sortSelect = document.getElementById('sortSelect');
            if (sortSelect) {
                sortSelect.addEventListener('change', function () {
                    sortBots(this.value);
                });
            }

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function () {
                    const searchTerm = this.value.toLowerCase();
                    const cards = document.querySelectorAll('[data-bot-id]');

                    cards.forEach(card => {
                        const botName = card.querySelector('h3').textContent.toLowerCase();
                        const creatorName = card.querySelector('.text-white\\/80').textContent.toLowerCase();

                        if (botName.includes(searchTerm) || creatorName.includes(searchTerm)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function () {
            // Load user profile
            loadUserProfile();

            // Set up event listeners
            setupEventListeners();

            // Load user's bots
            loadUserBots();
        });
    </script>
</body>

</html>